import { asFixtureId, type FixtureDescriptor } from "./types.js";

const editingArtifacts = [
  "catalog",
  "semantics",
  "resource-graph",
  "syntax",
  "provenance",
  "query",
  "diagnostics",
] as const;

const editingQueries = [
  "hover",
  "definition",
  "references",
  "completions",
  "diagnostics",
  "semanticTokens",
] as const;

const editingResources = [
  "element",
  "attribute",
  "value-converter",
  "binding-behavior",
  "template-controller",
] as const;

const editingTemplateFeatures = [
  "interpolation",
  "repeat",
  "if",
  "template-controller",
  "import",
] as const;

export const fixtures: readonly FixtureDescriptor[] = [
  // S1: Workspace editing loop seeds.
  {
    id: asFixtureId("explicit-app"),
    title: "explicit-app",
    description: "Decorator and static-au declarations with external templates.",
    origin: "resolution-app",
    root: { kind: "repo", path: "packages/compiler/test/project-semantics/apps/explicit-app" },
    scenarios: ["S1", "S6"],
    suites: ["workspace", "lsp-adapter", "integration-harness"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: editingResources,
      declarations: ["decorator", "decorator-config", "static-au"],
      scopes: ["global", "local"],
      templateFeatures: editingTemplateFeatures,
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Scenario seed: explicit-app", "Includes static-au and decorator patterns."],
  },
  {
    id: asFixtureId("convention-app"),
    title: "convention-app",
    description: "Convention-driven element discovery with template-import convention.",
    origin: "resolution-app",
    root: { kind: "repo", path: "packages/compiler/test/project-semantics/apps/convention-app" },
    scenarios: ["S1", "S6"],
    suites: ["workspace", "lsp-adapter", "integration-harness"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["element", "attribute", "value-converter"],
      declarations: ["convention"],
      scopes: ["global", "local"],
      templateFeatures: ["interpolation", "if", "import"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Scenario seed: convention-app", "Covers convention naming and implicit templates."],
  },
  {
    id: asFixtureId("sibling-app"),
    title: "sibling-app",
    description: "Sibling templates with local scope usage.",
    origin: "resolution-app",
    root: { kind: "repo", path: "packages/compiler/test/project-semantics/apps/sibling-app" },
    scenarios: ["S1", "S5", "S6"],
    suites: ["workspace", "lsp-adapter", "integration-harness"],
    coverage: {
      artifacts: [...editingArtifacts, "incremental"],
      queries: editingQueries,
      resources: ["element", "attribute"],
      declarations: ["decorator-config", "convention"],
      scopes: ["global", "local"],
      templateFeatures: ["interpolation", "import"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Scenario seed: sibling-app", "Baseline for incremental invalidation checks."],
  },
  {
    id: asFixtureId("playground-template-imports"),
    title: "playground/template-imports",
    description: "Template <import> coverage with aliases and local scope.",
    origin: "playground",
    root: { kind: "repo", path: "playground/template-imports" },
    scenarios: ["S1", "S3"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["element", "attribute"],
      declarations: ["decorator-config"],
      scopes: ["local", "imported"],
      templateFeatures: ["import", "interpolation"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Scenario seed: playground/template-imports"],
  },
  {
    id: asFixtureId("template-import-alias-conflicts"),
    title: "template-import-alias-conflicts",
    description: "Template <import> alias precedence over local registrations.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/template-import-alias-conflicts" },
    scenarios: ["S1", "S2"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["attribute"],
      declarations: ["decorator"],
      scopes: ["local", "imported"],
      templateFeatures: ["import"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["W2 scope/precedence: <import> alias vs local registration"],
  },
  {
    id: asFixtureId("workspace-contract"),
    title: "workspace-contract",
    description: "Curated LSP contract fixture with imports, scopes, and template breadth.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/workspace-contract" },
    scenarios: ["S1"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: [...editingArtifacts, "feature-usage"],
      queries: editingQueries,
      resources: ["element", "attribute", "value-converter", "binding-behavior", "template-controller"],
      declarations: ["decorator", "decorator-config", "static-au", "convention", "define"],
      scopes: ["global", "local", "imported"],
      templateFeatures: [
        "interpolation",
        "repeat",
        "if",
        "switch",
        "let",
        "template-controller",
        "containerless",
        "compose",
        "import",
      ],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Scenario seed: workspace-contract", "Primary LSP contract fixture."],
  },
  {
    id: asFixtureId("template-control-scenarios"),
    title: "template-control-scenarios",
    description: "Template controllers, projections, locals, and deep nesting scenarios.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/template-control-scenarios" },
    scenarios: ["S1"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["element", "template-controller"],
      declarations: ["decorator"],
      scopes: ["global", "local"],
      templateFeatures: ["interpolation", "repeat", "if", "switch", "let", "template-controller"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Public fixture for template controllers + projections + locals + deep nesting."],
  },
  {
    id: asFixtureId("binding-shorthand-syntax"),
    title: "binding-shorthand-syntax",
    description: "Shorthand binding syntax for commands and patterns.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/binding-shorthand-syntax" },
    scenarios: ["S1"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["attribute", "template-controller"],
      scopes: ["global"],
      templateFeatures: ["interpolation", "if", "template-controller"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["S1 shorthand syntax scaffold; assertions pending."],
  },
  {
    id: asFixtureId("template-local-scopes"),
    title: "template-local-scopes",
    description: "Local scope resolution for let/repeat/with bindings.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/template-local-scopes" },
    scenarios: ["S1"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["template-controller"],
      scopes: ["local"],
      templateFeatures: ["interpolation", "repeat", "if", "let", "template-controller"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["S1 local scope scaffold; bind-let + bind-repeat coverage pending."],
  },
  {
    id: asFixtureId("portal-chain"),
    title: "portal-chain",
    description: "Stacked controllers on a single element with portal chaining.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/portal-chain" },
    scenarios: ["S1"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["template-controller"],
      scopes: ["local"],
      templateFeatures: ["interpolation", "if", "template-controller"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Portal chain scaffold for stacked controller provenance."],
  },
  {
    id: asFixtureId("portal-deep-nesting"),
    title: "portal-deep-nesting",
    description: "Deeply nested portal + promise + repeat controller stack.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/portal-deep-nesting" },
    scenarios: ["S1"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["template-controller"],
      scopes: ["local"],
      templateFeatures: ["interpolation", "repeat", "if", "template-controller"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Portal deep-nesting scaffold; mirrors AOT deep-nesting vectors."],
  },
  {
    id: asFixtureId("let-edge-cases"),
    title: "let-edge-cases",
    description: "Let shadowing and nested repeat/let scope edges.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/let-edge-cases" },
    scenarios: ["S1"],
    suites: ["workspace", "lsp-adapter"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: ["template-controller"],
      scopes: ["local"],
      templateFeatures: ["interpolation", "repeat", "let", "template-controller"],
    },
    entry: "src/my-app.ts",
    templateEntry: "src/my-app.html",
    notes: ["Let edge-case scaffold; shadowing behavior assertions pending."],
  },

  // S2: Rename cascade + template edits.
  {
    id: asFixtureId("rename-cascade-basic"),
    title: "rename-cascade-basic",
    description: "Explicit attribute bindables plus <bindable> meta declarations.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/rename-cascade-basic" },
    scenarios: ["S2"],
    suites: ["workspace"],
    coverage: {
      artifacts: ["semantics", "provenance", "query", "diagnostics", "refactor"],
      queries: ["definition", "references", "diagnostics"],
      refactors: ["rename", "codeAction"],
      diagnostics: ["missing-required", "unknown-attribute"],
      resources: ["element", "attribute"],
      declarations: ["decorator-config"],
      scopes: ["local", "imported"],
      templateFeatures: ["import", "interpolation"],
    },
    entry: "src/app.ts",
    templateEntry: "src/app.html",
    notes: ["Scenario seed: rename-cascade-basic"],
  },

  // S3: Third-party consumption.
  {
    id: asFixtureId("aurelia2-table"),
    title: "aurelia2-table",
    description: "Third-party table plugin with rich bindable coverage.",
    origin: "third-party",
    root: { kind: "repo", path: "aurelia2-plugins/packages/aurelia2-table" },
    scenarios: ["S3"],
    suites: ["workspace", "integration-harness"],
    coverage: {
      artifacts: ["catalog", "semantics", "resource-graph", "syntax", "feature-usage", "diagnostics", "query"],
      queries: ["definition", "references", "diagnostics"],
      resources: ["element", "attribute", "value-converter", "binding-behavior"],
      declarations: ["decorator", "decorator-config"],
      scopes: ["global", "local"],
      templateFeatures: ["interpolation", "repeat", "import"],
    },
    notes: ["Scenario seed: aurelia2-table"],
  },
  {
    id: asFixtureId("aurelia2-outclick"),
    title: "aurelia2-outclick",
    description: "Third-party attribute with event-driven behavior.",
    origin: "third-party",
    root: { kind: "repo", path: "aurelia2-plugins/packages/aurelia2-outclick" },
    scenarios: ["S3"],
    suites: ["workspace", "integration-harness"],
    coverage: {
      artifacts: ["catalog", "semantics", "resource-graph", "diagnostics"],
      resources: ["attribute"],
      declarations: ["decorator"],
      scopes: ["global"],
    },
    notes: ["Scenario seed: aurelia2-outclick"],
  },
  {
    id: asFixtureId("aurelia2-forms"),
    title: "aurelia2-forms",
    description: "Third-party forms package with bindable metadata.",
    origin: "third-party",
    root: { kind: "repo", path: "aurelia2-plugins/packages/aurelia2-forms" },
    scenarios: ["S3"],
    suites: ["workspace", "integration-harness"],
    coverage: {
      artifacts: ["catalog", "semantics", "resource-graph", "diagnostics"],
      resources: ["element", "attribute"],
      declarations: ["decorator"],
      scopes: ["global"],
    },
    notes: ["Scenario seed: aurelia2-forms"],
  },
  {
    id: asFixtureId("aurelia2-google-maps"),
    title: "aurelia2-google-maps",
    description: "Gap-heavy third-party package to test policy and confidence.",
    origin: "third-party",
    root: { kind: "repo", path: "aurelia2-plugins/packages/aurelia2-google-maps" },
    scenarios: ["S3", "S7"],
    suites: ["workspace", "integration-harness"],
    coverage: {
      artifacts: ["catalog", "semantics", "resource-graph", "feature-usage", "diagnostics"],
      diagnostics: ["gap-confidence"],
      resources: ["element", "attribute"],
      declarations: ["decorator"],
      scopes: ["global"],
    },
    notes: ["Scenario seed: aurelia2-google-maps"],
  },
  {
    id: asFixtureId("template-imports-aurelia2-table"),
    title: "template-imports-aurelia2-table",
    description: "Integration-harness fixture for <import> with third-party package.",
    origin: "integration-harness",
    root: { kind: "repo", path: "packages/integration-harness/test/fixtures/template-imports-aurelia2-table" },
    scenarios: ["S3"],
    suites: ["integration-harness", "workspace"],
    coverage: {
      artifacts: ["catalog", "semantics", "resource-graph", "diagnostics"],
      resources: ["element", "attribute"],
      declarations: ["decorator-config"],
      scopes: ["local", "imported"],
      templateFeatures: ["import"],
    },
  },
  {
    id: asFixtureId("template-imports-multi-subpath"),
    title: "template-imports-multi-subpath",
    description: "Multi-subpath <import> coverage for third-party packages.",
    origin: "integration-harness",
    root: { kind: "repo", path: "packages/integration-harness/test/fixtures/template-imports-multi-subpath" },
    scenarios: ["S3", "S7"],
    suites: ["integration-harness", "workspace"],
    coverage: {
      artifacts: ["catalog", "semantics", "resource-graph", "diagnostics"],
      resources: ["element", "attribute"],
      scopes: ["local", "imported"],
      templateFeatures: ["import"],
    },
  },

  // S4: SSR and hydration parity.
  {
    id: asFixtureId("playground-basic-hydration"),
    title: "playground/basic-hydration",
    description: "SSR and hydration parity baseline from playground.",
    origin: "playground",
    root: { kind: "repo", path: "playground/basic-hydration" },
    scenarios: ["S4"],
    suites: ["runtime", "integration-harness"],
    coverage: {
      artifacts: ["aot", "ssr", "provenance", "diagnostics"],
      resources: ["element", "attribute"],
      templateFeatures: ["template-controller", "interpolation"],
    },
  },
  {
    id: asFixtureId("ssr-aurelia2-table"),
    title: "ssr-aurelia2-table",
    description: "SSR harness fixture using aurelia2-table resources.",
    origin: "integration-harness",
    root: { kind: "repo", path: "packages/integration-harness/test/fixtures/ssr-aurelia2-table" },
    scenarios: ["S4"],
    suites: ["runtime", "integration-harness"],
    coverage: {
      artifacts: ["aot", "ssr", "provenance"],
      resources: ["element", "attribute"],
    },
  },

  // S5: Incremental and caching integrity.
  {
    id: asFixtureId("incremental-churn"),
    title: "incremental-churn",
    description: "Two components share a custom attribute and local import.",
    origin: "semantic-workspace",
    root: { kind: "local", path: "cases/incremental-churn" },
    scenarios: ["S5"],
    suites: ["workspace"],
    coverage: {
      artifacts: ["semantics", "resource-graph", "provenance", "query", "diagnostics", "incremental"],
      queries: ["diagnostics", "definition", "references"],
      resources: ["element", "attribute"],
      declarations: ["decorator-config", "decorator"],
      scopes: ["local", "imported"],
      templateFeatures: ["import", "interpolation"],
    },
    entry: "src/app.ts",
    templateEntry: "src/app.html",
    notes: ["Scenario seed: incremental-churn"],
  },

  // S6: Determinism and ID stability.
  {
    id: asFixtureId("determinism-explicit-app"),
    title: "determinism-explicit-app",
    description: "Determinism run against explicit-app under varied roots.",
    origin: "resolution-app",
    root: { kind: "repo", path: "packages/compiler/test/project-semantics/apps/explicit-app" },
    scenarios: ["S6"],
    suites: ["workspace"],
    coverage: {
      artifacts: ["semantics", "provenance", "determinism"],
      queries: ["diagnostics"],
      resources: ["element", "attribute"],
      declarations: ["decorator-config", "static-au"],
      scopes: ["global", "local"],
    },
    notes: ["Run under multiple workspace roots to assert stable ids."],
  },

  // S7: Policy and confidence diagnostics.
  {
    id: asFixtureId("policy-gap-google-maps"),
    title: "policy-gap-google-maps",
    description: "Gap-heavy fixture for policy diagnostics.",
    origin: "third-party",
    root: { kind: "repo", path: "aurelia2-plugins/packages/aurelia2-google-maps" },
    scenarios: ["S7"],
    suites: ["workspace", "integration-harness"],
    coverage: {
      artifacts: ["semantics", "feature-usage", "diagnostics"],
      diagnostics: ["gap-confidence"],
      resources: ["element", "attribute"],
    },
    notes: ["Policy diagnostics should surface confidence downgrades."],
  },

  // S8: Semantic search and impact analysis.
  {
    id: asFixtureId("playground-kitchen-sink-csr"),
    title: "playground/kitchen-sink-csr",
    description: "Large graph for impact analysis and semantic search.",
    origin: "playground",
    root: { kind: "repo", path: "playground/kitchen-sink-csr" },
    scenarios: ["S8"],
    suites: ["workspace"],
    coverage: {
      artifacts: ["semantics", "resource-graph", "query"],
      queries: ["references", "diagnostics", "completions"],
      resources: ["element", "attribute", "value-converter", "binding-behavior"],
      templateFeatures: ["repeat", "if", "template-controller"],
    },
  },
  {
    id: asFixtureId("cortex-device-list"),
    title: "cortex-device-list",
    description: "Real-world app fixture (optional when checked out).",
    origin: "playground",
    root: { kind: "repo", path: "cortex-device-list" },
    scenarios: ["S8"],
    suites: ["workspace"],
    coverage: {
      artifacts: ["semantics", "resource-graph", "query"],
      queries: ["references", "diagnostics"],
      resources: ["element", "attribute"],
    },
    optional: true,
    notes: ["Optional fixture; only available when checked out locally."],
  },

  // S9: Transform and build integration.
  {
    id: asFixtureId("playground-issue-tracker"),
    title: "playground/issue-tracker",
    description: "AOT goldens and transform targets.",
    origin: "playground",
    root: { kind: "repo", path: "playground/issue-tracker" },
    scenarios: ["S9"],
    suites: ["transform", "integration-harness"],
    coverage: {
      artifacts: ["semantics", "feature-usage", "aot"],
      resources: ["element", "attribute"],
      templateFeatures: ["import", "interpolation"],
    },
  },
  {
    id: asFixtureId("transform-fixtures"),
    title: "transform-fixtures",
    description: "Transform package fixtures for AOT rewrite coverage.",
    origin: "transform",
    root: { kind: "repo", path: "packages/transform/test/fixtures" },
    scenarios: ["S9"],
    suites: ["transform"],
    coverage: {
      artifacts: ["feature-usage", "aot"],
    },
    notes: ["File-based fixtures; not a full workspace root."],
  },
  {
    id: asFixtureId("feature-matrix"),
    title: "feature-matrix",
    description:
      "Kitchen-sink fixture exercising all resource kinds, declaration forms, " +
      "template position types, and diagnostic triggers. Designed for systematic " +
      "cross-feature verification driven by domain specs.",
    origin: "workspace",
    root: { kind: "repo", path: "packages/semantic-workspace/test/fixtures/cases/feature-matrix" },
    scenarios: ["S1", "S3", "S5", "S6", "S7"],
    suites: ["workspace"],
    coverage: {
      artifacts: editingArtifacts,
      queries: editingQueries,
      resources: editingResources,
      declarations: ["decorator", "decorator-config", "convention", "define"],
      scopes: ["global", "local"],
      templateFeatures: editingTemplateFeatures,
    },
    entry: "src/app.ts",
    templateEntry: "src/app.html",
    notes: [
      "Designed from feature specs (hover, completions, diagnostics, navigation, rename, semantic tokens).",
      "One instance of each resource kind with varied declaration forms.",
      "Template exercises all 10 position types from completions-spec.",
      "Includes deliberate errors for diagnostic regime testing.",
    ],
  },
];
