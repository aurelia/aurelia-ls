[
  {
    "name": "L-01 text interpolation",
    "markup": "<div>${a}</div>",
    "expect": {
      "expressions": [
        { "kind": "text", "code": "a" }
      ]
    }
  },
  {
    "name": "L-02 data-* mix (.bind + interpolation)",
    "markup": "<div data-a=\"b\" data-b.bind=\"1\" data-c=\"${hey}\">",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "1" },
        { "kind": "attrInterpolation", "on": "data-c", "code": "hey" }
      ]
    }
  },
  {
    "name": "L-03 class command + interpolation",
    "markup": "<div d.class=\"a\" class=\"a ${b} c\">",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "a" },
        { "kind": "attrInterpolation", "on": "class", "code": "b" }
      ]
    }
  },
  {
    "name": "L-04 style command + interpolation",
    "markup": "<div bg.style=\"a\" style=\"a ${b} c\">",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "a" },
        { "kind": "attrInterpolation", "on": "style", "code": "b" }
      ]
    }
  },
  {
    "name": "L-05 ref expression",
    "markup": "<div ref=el>",
    "expect": {
      "expressions": [
        { "kind": "ref", "on": "element", "code": "el" }
      ]
    }
  },
  {
    "name": "L-06 event trigger",
    "markup": "<el foo.trigger=\"1\">",
    "expect": {
      "expressions": [
        { "kind": "event", "on": "foo", "command": "trigger", "code": "1" }
      ]
    }
  },
  {
    "name": "L-07 binding modes",
    "markup": "<el p1.bind=\"x\" p2.one-time=\"y\" p3.to-view=\"z\" p4.from-view=\"w\" p5.two-way=\"v\">",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "x" },
        { "kind": "propCommand", "command": "one-time", "code": "y" },
        { "kind": "propCommand", "command": "to-view", "code": "z" },
        { "kind": "propCommand", "command": "from-view", "code": "w" },
        { "kind": "propCommand", "command": "two-way", "code": "v" }
      ]
    }
  },
  {
    "name": "L-08 custom attribute with interpolation",
    "markup": "<div my-attr=\"${attr}\">",
    "expect": {
      "expressions": [
        { "kind": "attrInterpolation", "on": "my-attr", "code": "attr" }
      ]
    }
  },
  {
    "name": "L-09 custom attribute .bind",
    "markup": "<div my-attr.bind=\"v\">",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "v" }
      ]
    }
  },
  {
    "name": "L-10 CA on <template>",
    "markup": "<template my-attr.bind=\"v\"></template>",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "v" }
      ]
    }
  },
  {
    "name": "L-15 controller value: if.bind",
    "markup": "<div if.bind=\"p\"></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" }
      ]
    }
  },
  {
    "name": "L-16 attrs lifted inside controller",
    "markup": "<el name.bind=\"name\" title.bind=\"title\" if.bind=\"p\"></el>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "name" },
        { "kind": "propCommand", "command": "bind", "code": "title" },
        { "kind": "controllerValue", "command": "bind", "code": "p" }
      ]
    }
  },
  {
    "name": "L-17 nested controllers chain",
    "markup": "<div if><div with><div promise><div portal></div></div></div></div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "with" },
        { "name": "promise" },
        { "name": "portal" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "controllerValue", "command": "bind", "code": "with" },
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "controllerValue", "command": "bind", "code": "portal" }
      ]
    }
  },
  {
    "name": "L-18 controllers on inner child",
    "markup": "<div><div if id=\"1\" repeat.for=\"i of ii\" with></div></div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "repeat" },
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "iterator" },
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "controllerValue", "command": "bind", "code": "with" }
      ]
    }
  },
  {
    "name": "L-19 <let/> no bindings",
    "markup": "<template><let></let></template>",
    "expect": {
      "lets": []
    }
  },
  {
    "name": "L-20 <let/> with .bind and interpolation",
    "markup": "<let a.bind=\"b\" c=\"${d}\"></let>",
    "expect": {
      "lets": [
        { "name": "a", "toBindingContext": false, "hasValue": true },
        { "name": "c", "toBindingContext": false, "hasValue": true }
      ],
      "expressions": [
        { "kind": "letValue", "on": "a", "code": "b", "command": "bind" },
        { "kind": "letValue", "on": "c", "code": "d" }
      ]
    }
  },
  {
    "name": "L-21 <let to-binding-context>",
    "markup": "<template><let to-binding-context a.bind=\"a\"></let></template>",
    "expect": {
      "lets": [
        { "name": "a", "toBindingContext": true, "hasValue": true }
      ],
      "expressions": [
        { "kind": "letValue", "on": "a", "code": "a", "command": "bind" }
      ]
    }
  },
  {
    "name": "L-22 colon shorthand (to-view)",
    "markup": "<div :title=\"a\">",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "to-view", "code": "a" }
      ]
    }
  },
  {
    "name": "L-23 @click trigger",
    "markup": "<button @click=\"go()\">",
    "expect": {
      "expressions": [
        { "kind": "event", "on": "click", "command": "trigger", "code": "go()" }
      ]
    }
  },
  {
    "name": "L-24 click.capture",
    "markup": "<button click.capture=\"do()\">",
    "expect": {
      "expressions": [
        { "kind": "event", "on": "click", "command": "capture", "code": "do()" }
      ]
    }
  },
  {
    "name": "L-25 view-model.ref",
    "markup": "<my-el view-model.ref=\"vm\">",
    "expect": {
      "expressions": [
        { "kind": "ref", "on": "component", "code": "vm" }
      ]
    }
  },
  {
    "name": "L-26 .attr override",
    "markup": "<div title.attr=\"a + b\">",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "a + b" }
      ]
    }
  },
  {
    "name": "L-27 text interpolation with multiple ${}",
    "markup": "<div>pre ${x} mid ${y} post</div>",
    "expect": {
      "expressions": [
        { "kind": "text", "code": "x" },
        { "kind": "text", "code": "y" }
      ]
    }
  },
  {
    "name": "L-28 attribute interpolation with multiple ${}",
    "markup": "<div title=\"pre ${x} mid ${y} post\">",
    "expect": {
      "expressions": [
        { "kind": "attrInterpolation", "on": "title", "code": "x" },
        { "kind": "attrInterpolation", "on": "title", "code": "y" }
      ]
    }
  },
  {
    "name": "L-29 interpolation with nested braces and quotes",
    "markup": "<div>${a ? {b: c} : \"}\"}</div>",
    "expect": {
      "expressions": [
        { "kind": "text", "code": "a ? {b: c} : \"}\"" }
      ]
    }
  },
  {
    "name": "L-30 multiple controllers on same element (wrap right-to-left)",
    "markup": "<div if.bind=\"i\" with.bind=\"w\" promise.bind=\"p\"></div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "with" },
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "i" },
        { "kind": "controllerValue", "command": "bind", "code": "w" },
        { "kind": "controllerValue", "command": "bind", "code": "p" }
      ]
    }
  },
  {
    "name": "L-31 repeat + if + with on same element",
    "markup": "<ul repeat.for=\"i of items\" if.bind=\"cond\" with.bind=\"ctx\"></ul>",
    "expect": {
      "controllers": [
        { "name": "repeat" },
        { "name": "if" },
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "iterator" },
        { "kind": "controllerValue", "command": "bind", "code": "cond" },
        { "kind": "controllerValue", "command": "bind", "code": "ctx" }
      ]
    }
  },
  {
    "name": "L-32 skip local custom element template",
    "markup": "<template as-custom-element=\"user-card\" if.bind=\"c\"></template>",
    "expect": {
      "controllers": [],
      "expressions": []
    }
  },
  {
    "name": "L-33 let with multiple ${} expressions",
    "markup": "<let a=\"x ${y} z ${z}\"></let>",
    "expect": {
      "lets": [
        { "name": "a", "toBindingContext": false, "hasValue": true }
      ],
      "expressions": [
        { "kind": "letValue", "on": "a", "code": "y" },
        { "kind": "letValue", "on": "a", "code": "z" }
      ]
    }
  },
  {
    "name": "L-34 attribute interpolation data-* preserved (extra)",
    "markup": "<div data-info=\"a ${b} c\">",
    "expect": {
      "expressions": [
        { "kind": "attrInterpolation", "on": "data-info", "code": "b" }
      ]
    }
  },
  {
    "name": "L-35 promise branches with then/catch and inner text",
    "markup": "<div promise><template then=\"r\"><span>${a}</span></template><template catch><span>${b}</span></template></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "text", "code": "a" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "L-36 switch with case/default and inner text",
    "markup": "<div switch.bind=\"x\"><template case=\"1\"><span>${a}</span></template><template default-case><span>${b}</span></template></div>",
    "expect": {
      "controllers": [
        { "name": "switch" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "x" },
        { "kind": "propCommand", "command": "bind", "code": "1" },
        { "kind": "text", "code": "a" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "L-37 class.attr override + class interpolation combo",
    "markup": "<div title.attr=\"x\" class=\"a ${b} c\">",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "x" },
        { "kind": "attrInterpolation", "on": "class", "code": "b" }
      ]
    }
  },
  {
    "name": "L-38 @click with modifier (:once)",
    "markup": "<button @click:once=\"go()\">",
    "expect": {
      "expressions": [
        { "kind": "event", "on": "click", "command": "trigger", "code": "go()" }
      ]
    }
  },
  {
    "name": "L-39 switch default-case only (value-less controller)",
    "markup": "<div switch><template default-case><span>${a}</span></template></div>",
    "expect": {
      "controllers": [
        { "name": "switch" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "switch" },
        { "kind": "text", "code": "a" }
      ]
    }
  },
  {
    "name": "L-40 promise.bind with then branch only",
    "markup": "<div promise.bind=\"p\"><template then><b>${a}</b></template></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "a" }
      ]
    }
  },
  {
    "name": "L-41 promise.catch only (value-less)",
    "markup": "<div promise><template catch><i>${e}</i></template></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "text", "code": "e" }
      ]
    }
  },
  {
    "name": "L-42 ref lifted inside if controller",
    "markup": "<div ref=el if.bind=\"c\"></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "ref", "on": "element", "code": "el" },
        { "kind": "controllerValue", "command": "bind", "code": "c" }
      ]
    }
  },
  {
    "name": "L-43 style.prop with controller",
    "markup": "<div bg.style=\"a\" if></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "a" },
        { "kind": "controllerValue", "command": "bind", "code": "if" }
      ]
    }
  },
  {
    "name": "L-44 attr interpolation with controller",
    "markup": "<div if title=\"a ${b}\"></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "attrInterpolation", "on": "title", "code": "b" }
      ]
    }
  },
  {
    "name": "L-45 two text nodes",
    "markup": "<div>${a}</div><div>${b}</div>",
    "expect": {
      "expressions": [
        { "kind": "text", "code": "a" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "L-46 let under if",
    "markup": "<div if><let a.bind=\"b\"></let></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "lets": [
        { "name": "a", "toBindingContext": false, "hasValue": true }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "letValue", "on": "a", "code": "b", "command": "bind" }
      ]
    }
  },
  {
    "name": "L-47 let interpolation with brace in string",
    "markup": "<let a=\"${x ? '}': 1}\"></let>",
    "expect": {
      "lets": [
        { "name": "a", "toBindingContext": false, "hasValue": true }
      ],
      "expressions": [
        { "kind": "letValue", "on": "a", "code": "x ? '}': 1" }
      ]
    }
  },
  {
    "name": "L-48 controllers with attribute between",
    "markup": "<div if a.bind=\"b\" with></div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "controllerValue", "command": "bind", "code": "with" },
        { "kind": "propCommand", "command": "bind", "code": "b" }
      ]
    }
  },
  {
    "name": "L-49 attribute interpolation aria-* preserved",
    "markup": "<div aria-label=\"Hi ${name}\">",
    "expect": {
      "expressions": [
        { "kind": "attrInterpolation", "on": "aria-label", "code": "name" }
      ]
    }
  },
  {
    "name": "L-50 colon shorthand inside controller",
    "markup": "<div :title=\"a\" if></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "propCommand", "command": "to-view", "code": "a" },
        { "kind": "controllerValue", "command": "bind", "code": "if" }
      ]
    }
  },
  {
    "name": "L-51 @event inside controller",
    "markup": "<div @click=\"go()\" with></div>",
    "expect": {
      "controllers": [
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "event", "on": "click", "command": "trigger", "code": "go()" },
        { "kind": "controllerValue", "command": "bind", "code": "with" }
      ]
    }
  },
  {
    "name": "L-52 view-model.ref inside controller",
    "markup": "<my-el view-model.ref=\"vm\" with></my-el>",
    "expect": {
      "controllers": [
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "ref", "on": "component", "code": "vm" },
        { "kind": "controllerValue", "command": "bind", "code": "with" }
      ]
    }
  },
  {
    "name": "L-53 switch with case only",
    "markup": "<div switch.bind=\"x\"><template case=\"y\"><b>${z}</b></template></div>",
    "expect": {
      "controllers": [
        { "name": "switch" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "x" },
        { "kind": "propCommand", "command": "bind", "code": "y" },
        { "kind": "text", "code": "z" }
      ]
    }
  },
  {
    "name": "L-54 repeat with text inside",
    "markup": "<ul repeat.for=\"i of items\"><li>${i}</li></ul>",
    "expect": {
      "controllers": [
        { "name": "repeat" }
      ],
      "expressions": [
        { "kind": "iterator" },
        { "kind": "text", "code": "i" }
      ]
    }
  },
  {
    "name": "L-55 promise branches on elements (.from-view)",
    "markup": "<div promise.bind=\"p\"><span then.from-view=\"data\">${data.toUpperCase()}</span><i catch.from-view=\"err\">${err}</i><span pending>loading</span></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "data.toUpperCase()" },
        { "kind": "text", "code": "err" }
      ]
    }
  },
  {
    "name": "L-56 promise branches on elements (plain attr)",
    "markup": "<div promise.bind=\"p\"><span then=\"d\">${d}</span><b catch=\"e\">${e}</b></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "d" },
        { "kind": "text", "code": "e" }
      ]
    }
  },
  {
    "name": "L-57 promise (value-less) with element branches (value-less)",
    "markup": "<div promise><span then>${a}</span><span catch>${b}</span></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "text", "code": "a" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "L-58 promise with mixed branch authoring (template + element)",
    "markup": "<div promise.bind=\"p\"><template then=\"x\"><em>${x}</em></template><span catch.from-view=\"y\">${y}</span></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "x" },
        { "kind": "text", "code": "y" }
      ]
    }
  },
  {
    "name": "L-59 custom element alias containerless + bindable",
    "semOverrides": {
      "resources": {
        "elements": {
          "x-widget": {
            "kind": "element",
            "name": "x-widget",
            "aliases": ["x-alias"],
            "boundary": true,
            "containerless": true,
            "bindables": {
              "foo": { "name": "foo", "mode": "toView" }
            }
          }
        }
      }
    },
    "markup": "<div as-element=\"x-alias\" foo.bind=\"bar\"></div>",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "code": "bar", "command": "bind" }
      ],
      "elements": [
        { "res": "x-widget", "containerless": true, "props": ["foo"] }
      ]
    }
  },
  {
    "name": "L-60 custom attribute alias hydrates attribute with bindable",
    "semOverrides": {
      "resources": {
        "attributes": {
          "fancy-attr": {
            "kind": "attribute",
            "name": "fancy-attr",
            "aliases": ["fancy"],
            "isTemplateController": false,
            "bindables": {
              "value": { "name": "value", "mode": "toView" }
            }
          }
        }
      }
    },
    "markup": "<div fancy.bind=\"x\"></div>",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "code": "x", "command": "bind" }
      ],
      "attributes": [
        { "res": "fancy-attr", "alias": "fancy", "props": ["value"] }
      ]
    }
  },
  {
    "name": "L-61 custom element literal bindable emits setProperty",
    "semOverrides": {
      "resources": {
        "elements": {
          "x-panel": {
            "kind": "element",
            "name": "x-panel",
            "boundary": true,
            "bindables": {
              "title": { "name": "title", "mode": "toView" }
            }
          }
        }
      }
    },
    "markup": "<x-panel title=\"Hello\"></x-panel>",
    "expect": {
      "expressions": [],
      "elements": [
        {
          "res": "x-panel",
          "containerless": false,
          "props": [
            "title"
          ]
        }
      ]
    }
  },
  {
    "name": "L-62 custom element interpolation on bindable emits attributeBinding",
    "semOverrides": {
      "resources": {
        "elements": {
          "x-panel": {
            "kind": "element",
            "name": "x-panel",
            "boundary": true,
            "bindables": {
              "title": { "name": "title", "mode": "toView" }
            }
          }
        }
      }
    },
    "markup": "<x-panel title=\"Hi ${name}\"></x-panel>",
    "expect": {
      "expressions": [
        { "kind": "attrInterpolation", "on": "title", "code": "name" }
      ],
      "elements": [
        {
          "res": "x-panel",
          "containerless": false,
          "props": [
            "title"
          ]
        }
      ]
    }
  },
  {
    "name": "L-63 custom element bindable wins over same-named custom attribute",
    "semOverrides": {
      "resources": {
        "elements": {
          "x-thing": {
            "kind": "element",
            "name": "x-thing",
            "boundary": true,
            "bindables": {
              "fancy": { "name": "fancy", "mode": "toView" }
            }
          }
        },
        "attributes": {
          "fancy": {
            "kind": "attribute",
            "name": "fancy",
            "isTemplateController": false,
            "bindables": {
              "value": { "name": "value", "mode": "toView" }
            },
            "primary": "value"
          }
        }
      }
    },
    "markup": "<x-thing fancy.bind=\"vm\"></x-thing>",
    "expect": {
      "expressions": [
        { "kind": "propCommand", "code": "vm", "command": "bind" }
      ],
      "elements": [
        {
          "res": "x-thing",
          "containerless": false,
          "props": [
            "fancy"
          ]
        }
      ],
      "attributes": []
    }
  },
  {
    "name": "L-64 custom attribute literal binds primary property",
    "semOverrides": {
      "resources": {
        "attributes": {
          "note": {
            "kind": "attribute",
            "name": "note",
            "isTemplateController": false,
            "bindables": {
              "value": { "name": "value", "mode": "toView" }
            },
            "primary": "value"
          }
        }
      }
    },
    "markup": "<div note=\"hello\"></div>",
    "expect": {
      "expressions": [],
      "attributes": [
        {
          "res": "note",
          "alias": null,
          "props": [
            "value"
          ]
        }
      ]
    }
  }
]
