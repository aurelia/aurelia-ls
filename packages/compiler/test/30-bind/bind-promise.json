[
  {
    "name": "PR-01 promise.bind with then branch: value in root; alias + inner binding in nested then overlay",
    "markup": "<div promise.bind=\"p\"><template then=\"r\"><span title.bind=\"a\"></span></template></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:promise@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "promise" },
        { "label": "overlay:then@2", "parent": "overlay:promise@1", "kind": "overlay", "overlay": null, "origin": "then" }
      ],
      "locals": [
        { "frame": "overlay:then@2", "kind": "promiseAlias", "name": "r" }
      ],
      "exprs": [
        { "kind": "expr", "frame": "root", "code": "p" },
        { "kind": "expr", "frame": "overlay:then@2", "code": "a" }
      ],
      "diags": []
    }
  },
  {
    "name": "PR-02 promise (value-less) with catch branch only; default alias in catch overlay",
    "markup": "<div promise><template catch><i>${e}</i></template></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:promise@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "promise" },
        { "label": "overlay:catch@2", "parent": "overlay:promise@1", "kind": "overlay", "overlay": null, "origin": "catch" }
      ],
      "locals": [
        { "frame": "overlay:catch@2", "kind": "promiseAlias", "name": "catch" }
      ],
      "exprs": [
        { "kind": "expr", "frame": "root", "code": "promise" },
        { "kind": "expr", "frame": "overlay:catch@2", "code": "e" }
      ],
      "diags": []
    }
  },
  {
    "name": "PR-03 promise with both then and catch branches - each in own overlay",
    "markup": "<div promise.bind=\"task\"><template then=\"val\"><b>${a}</b></template><template catch=\"err\"><i>${b}</i></template></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:promise@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "promise" },
        { "label": "overlay:then@2", "parent": "overlay:promise@1", "kind": "overlay", "overlay": null, "origin": "then" },
        { "label": "overlay:catch@3", "parent": "overlay:promise@1", "kind": "overlay", "overlay": null, "origin": "catch" }
      ],
      "locals": [
        { "frame": "overlay:then@2", "kind": "promiseAlias", "name": "val" },
        { "frame": "overlay:catch@3", "kind": "promiseAlias", "name": "err" }
      ],
      "exprs": [
        { "kind": "expr", "frame": "root", "code": "task" },
        { "kind": "expr", "frame": "overlay:then@2", "code": "a" },
        { "kind": "expr", "frame": "overlay:catch@3", "code": "b" }
      ],
      "diags": []
    }
  },
  {
    "name": "PR-04 promise inside with",
    "markup": "<div with.bind=\"ctx\"><div promise.bind=\"p\"><template then><span>${x}</span></template></div></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:with@1", "parent": "root", "kind": "overlay", "overlay": "with", "origin": "with" },
        { "label": "overlay:promise@2", "parent": "overlay:with@1", "kind": "overlay", "overlay": null, "origin": "promise" },
        { "label": "overlay:then@3", "parent": "overlay:promise@2", "kind": "overlay", "overlay": null, "origin": "then" }
      ],
      "locals": [
        { "frame": "overlay:then@3", "kind": "promiseAlias", "name": "then" }
      ],
      "exprs": [
        { "kind": "expr", "frame": "root", "code": "ctx" },
        { "kind": "expr", "frame": "overlay:with@1", "code": "p" },
        { "kind": "expr", "frame": "overlay:then@3", "code": "x" }
      ],
      "diags": []
    }
  },
  {
    "name": "PR-05 promise branch contains with",
    "markup": "<div promise.bind=\"p\"><template then><section with.bind=\"w\"><i>${z}</i></section></template></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:promise@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "promise" },
        { "label": "overlay:then@2", "parent": "overlay:promise@1", "kind": "overlay", "overlay": null, "origin": "then" },
        { "label": "overlay:with@3", "parent": "overlay:then@2", "kind": "overlay", "overlay": "with", "origin": "with" }
      ],
      "locals": [
        { "frame": "overlay:then@2", "kind": "promiseAlias", "name": "then" }
      ],
      "exprs": [
        { "kind": "expr", "frame": "root", "code": "p" },
        { "kind": "expr", "frame": "overlay:then@2", "code": "w" },
        { "kind": "expr", "frame": "overlay:with@3", "code": "z" }
      ],
      "diags": []
    }
  }
]
