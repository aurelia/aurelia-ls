[
  {
    "name": "RPT-01 repeat overlay: header in outer; inner text in repeat overlay",
    "markup": "<ul repeat.for=\"i of items\"><li>${i}</li></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "i" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "i", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "RPT-02 repeat inside with: header in with overlay; inner attr binding in repeat overlay",
    "markup": "<div with.bind=\"ctx\"><ul repeat.for=\"i of items\"><li title.bind=\"t\"></li></ul></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:valueOverlay@1", "parent": "root", "kind": "overlay", "overlay": "value", "origin": "valueOverlay" },
        { "label": "overlay:iterator@2", "parent": "overlay:valueOverlay@1", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@2", "kind": "iteratorLocal", "name": "i" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$middle" }
      ],
      "exprs": [
        { "kind": "expr", "code": "ctx", "frame": "root" },
        { "kind": "forOfHeader", "frame": "overlay:valueOverlay@1" },
        { "kind": "expr", "code": "t", "frame": "overlay:iterator@2" }
      ],
      "diags": []
    }
  },
  {
    "name": "RPT-03 nested repeat: inner header in outer repeat overlay; inner text uses i and j in inner overlay",
    "markup": "<ul repeat.for=\"i of items\"><li repeat.for=\"j of i.children\">${i}-${j}</li></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" },
        { "label": "overlay:iterator@2", "parent": "overlay:iterator@1", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "i" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" },
        { "frame": "overlay:iterator@2", "kind": "iteratorLocal", "name": "j" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@2", "kind": "contextual", "name": "$middle" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "forOfHeader", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "i", "frame": "overlay:iterator@2" },
        { "kind": "expr", "code": "j", "frame": "overlay:iterator@2" }
      ],
      "diags": []
    }
  },
  {
    "name": "RPT-04 array destructuring locals",
    "markup": "<div><span repeat.for=\"[a,b] of items\">${a}${b}</span></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "a" },
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "b" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "a", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "b", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "RPT-05 object destructuring locals",
    "markup": "<div><span repeat.for=\"{x,y} of items\">${x}${y}</span></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "x" },
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "y" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "x", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "y", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "RPT-06 repeat contextuals used in overlay",
    "markup": "<ul repeat.for=\"i of items\"><li>${$index}-${$length}-${$odd}</li></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "i" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "$index", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "$length", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "$odd", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "RPT-07 array destructuring with hole + rest",
    "markup": "<div><span repeat.for=\"[a,,...rest] of items\">${a}-${rest[0]}</span></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "a" },
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "rest" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "a", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "rest[0]", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "RPT-08 object destructuring with rest",
    "markup": "<div><span repeat.for=\"{x, y: alias, ...rest} of items\">${alias}-${rest.extra}</span></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "x" },
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "alias" },
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "rest" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "alias", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "rest.extra", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  }
]
