[
  {
    "name": "DG-01 duplicate let names in with overlay -> aurelia/invalid-binding-pattern",
    "markup": "<div with.bind=\"ctx\"><let a.bind=\"x\"></let><let a.bind=\"y\"></let></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:valueOverlay@1", "parent": "root", "kind": "overlay", "overlay": "value", "origin": "valueOverlay" }
      ],
      "locals": [
        { "frame": "overlay:valueOverlay@1", "kind": "let", "name": "a" }
      ],
      "exprs": [
        { "kind": "expr", "code": "ctx", "frame": "root" },
        { "kind": "expr", "code": "x", "frame": "overlay:valueOverlay@1" },
        { "kind": "expr", "code": "y", "frame": "overlay:valueOverlay@1" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "DG-02 repeat header missing 'of' -> aurelia/invalid-binding-pattern",
    "markup": "<ul repeat.for=\"item items\"></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "DG-03 repeat header bad destructuring -> aurelia/invalid-binding-pattern",
    "markup": "<ul repeat.for=\"{x,,y} of items\"></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "DG-04 invalid binding expression surfaces aurelia/expr-parse-error",
    "markup": "<div title.bind=\"foo(\"></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null }
      ],
      "locals": [],
      "exprs": [
        { "kind": "expr", "code": "foo(", "frame": "root" }
      ],
      "diags": [
        { "code": "aurelia/expr-parse-error" }
      ]
    }
  },
  {
    "name": "DG-05 iterator local conflicts with let name -> aurelia/invalid-binding-pattern",
    "markup": "<ul repeat.for=\"item of items\"><let item.bind=\"other\"></let></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "item" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$previous" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "other", "frame": "overlay:iterator@1" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "DG-06 invalid expression in listener context surfaces aurelia/expr-parse-error",
    "markup": "<button click.trigger=\"handle(\"></button>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null }
      ],
      "locals": [],
      "exprs": [
        { "kind": "expr", "code": "handle(", "frame": "root" }
      ],
      "diags": [
        { "code": "aurelia/expr-parse-error" }
      ]
    }
  },
  {
    "name": "DG-07 invalid expression in interpolation surfaces aurelia/expr-parse-error",
    "markup": "<div>${foo(}</div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null }
      ],
      "locals": [],
      "exprs": [
        { "kind": "expr", "code": "foo(", "frame": "root" }
      ],
      "diags": [
        { "code": "aurelia/expr-parse-error" }
      ]
    }
  },
  {
    "name": "DG-08 object destructuring with default value extracts name correctly",
    "markup": "<ul repeat.for=\"{x = 5} of items\"><li>${x}</li></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "x" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$previous" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "x", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "DG-09 array destructuring with default value extracts name correctly",
    "markup": "<ul repeat.for=\"[a = 1, b = 2] of items\"><li>${a}-${b}</li></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "a" },
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "b" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$previous" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "a", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "b", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "DG-10 deeply nested destructuring extracts all names",
    "markup": "<ul repeat.for=\"{a: {b: {c}}} of items\"><li>${c}</li></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "c" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$previous" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "c", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "DG-11 mixed array/object destructuring extracts all names",
    "markup": "<ul repeat.for=\"[{x}, [y, z]] of items\"><li>${x}-${y}-${z}</li></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "x" },
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "y" },
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "z" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$previous" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "x", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "y", "frame": "overlay:iterator@1" },
        { "kind": "expr", "code": "z", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  },
  {
    "name": "DG-12 multiple expression errors accumulate",
    "markup": "<div title.bind=\"foo(\" class.bind=\"bar[\"></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null }
      ],
      "locals": [],
      "exprs": [
        { "kind": "expr", "code": "foo(", "frame": "root" },
        { "kind": "expr", "code": "bar[", "frame": "root" }
      ],
      "diags": [
        { "code": "aurelia/expr-parse-error" },
        { "code": "aurelia/expr-parse-error" }
      ]
    }
  },
  {
    "name": "DG-13 let shadowing contextual variable -> aurelia/invalid-binding-pattern",
    "markup": "<ul repeat.for=\"i of items\"><let $index.bind=\"0\"></let></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "i" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$previous" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "0", "frame": "overlay:iterator@1" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "DG-14 invalid expression in controller value surfaces aurelia/expr-parse-error",
    "markup": "<div if.bind=\"foo(\"></div>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null }
      ],
      "locals": [],
      "exprs": [
        { "kind": "expr", "code": "foo(", "frame": "root" }
      ],
      "diags": [
        { "code": "aurelia/expr-parse-error" }
      ]
    }
  },
  {
    "name": "DG-15 invalid expression in repeat collection surfaces aurelia/invalid-binding-pattern",
    "markup": "<ul repeat.for=\"i of items[\"></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "DG-16 object destructuring with renamed property extracts alias",
    "markup": "<ul repeat.for=\"{x: renamed} of items\"><li>${renamed}</li></ul>",
    "expect": {
      "frames": [
        { "label": "root", "parent": null, "kind": "root", "overlay": null, "origin": null },
        { "label": "overlay:iterator@1", "parent": "root", "kind": "overlay", "overlay": null, "origin": "iterator" }
      ],
      "locals": [
        { "frame": "overlay:iterator@1", "kind": "iteratorLocal", "name": "renamed" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$index" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$first" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$last" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$even" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$odd" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$length" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$middle" },
        { "frame": "overlay:iterator@1", "kind": "contextual", "name": "$previous" }
      ],
      "exprs": [
        { "kind": "forOfHeader", "frame": "root" },
        { "kind": "expr", "code": "renamed", "frame": "overlay:iterator@1" }
      ],
      "diags": []
    }
  }
]
