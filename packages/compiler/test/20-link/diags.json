[
  {
    "name": "R-D-02 repeat with unknown tail option surfaces aurelia/invalid-command-usage",
    "markup": "<ul repeat.for=\"item of items; bogus: true\"></ul>",
    "expect": {
      "items": [
        { "kind": "iterator", "res": "repeat", "to": "items" }
      ],
      "diags": [
        { "code": "aurelia/invalid-command-usage" }
      ]
    }
  },
  {
    "name": "R-D-10 [else] without preceding [if] surfaces aurelia/invalid-command-usage",
    "markup": "<div else>orphan else</div>",
    "expect": {
      "items": [],
      "diags": [
        { "code": "aurelia/invalid-command-usage" }
      ]
    }
  },
  {
    "name": "R-D-11 [else] after non-if sibling surfaces aurelia/invalid-command-usage",
    "markup": "<div repeat.for=\"i of items\">loop</div><div else>wrong parent</div>",
    "expect": {
      "items": [
        { "kind": "iterator", "res": "repeat", "to": "items" }
      ],
      "diags": [
        { "code": "aurelia/invalid-command-usage" }
      ]
    }
  },
  {
    "name": "R-D-12 valid [if]/[else] pair has no diagnostics",
    "markup": "<div if.bind=\"x\">yes</div><div else>no</div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "if", "to": "value", "target": "controller", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-13 valid [promise]/[then]/[catch] has no diagnostics",
    "markup": "<div promise.bind=\"p\"><template then>resolved</template><template catch>error</template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "promise", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "then", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "then", "branch": "then" },
        { "kind": "ctrlProp", "res": "catch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "catch", "branch": "catch" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-14 [case] without parent [switch] surfaces aurelia/invalid-command-usage",
    "markup": "<template case.bind=\"x\">orphan case</template>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": [
        { "code": "aurelia/invalid-command-usage" }
      ]
    }
  },
  {
    "name": "R-D-15 [default-case] without parent [switch] surfaces aurelia/invalid-command-usage",
    "markup": "<template default-case>orphan default</template>",
    "expect": {
      "items": [
        { "kind": "branch", "res": "default-case", "branch": "default" }
      ],
      "diags": [
        { "code": "aurelia/invalid-command-usage" }
      ]
    }
  },
  {
    "name": "R-D-16 valid [switch]/[case]/[default-case] has no diagnostics",
    "markup": "<div switch.bind=\"x\"><template case.bind=\"1\">one</template><template default-case>other</template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "branch", "res": "default-case", "branch": "default" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-17 multiple [default-case] in same switch surfaces aurelia/invalid-command-usage",
    "markup": "<div switch.bind=\"x\"><template default-case>one</template><template default-case>two</template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "default-case", "branch": "default" },
        { "kind": "branch", "res": "default-case", "branch": "default" }
      ],
      "diags": [
        { "code": "aurelia/invalid-command-usage" }
      ]
    }
  },
  {
    "name": "R-D-20 unknown binding behavior surfaces aurelia/unknown-behavior",
    "markup": "<div textcontent.bind=\"value & unknownBehavior\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-behavior" }
      ]
    }
  },
  {
    "name": "R-D-21 duplicate binding behavior surfaces aurelia/invalid-binding-pattern",
    "markup": "<div textcontent.bind=\"value & debounce & debounce\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "R-D-22 unknown value converter surfaces aurelia/unknown-converter",
    "markup": "<div textcontent.bind=\"value | unknownConverter\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-converter" }
      ]
    }
  },
  {
    "name": "R-D-23 registered binding behavior has no diagnostic",
    "markup": "<div textcontent.bind=\"value & debounce\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-24 registered value converter has no diagnostic",
    "markup": "<div textcontent.bind=\"value | sanitize\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-25 multiple different non-conflicting behaviors allowed",
    "markup": "<div textcontent.bind=\"value & debounce & signal\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-26 conflicting rate-limiters (debounce + throttle) surfaces aurelia/invalid-binding-pattern",
    "markup": "<div textcontent.bind=\"value & debounce & throttle\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "R-D-27 conflicting rate-limiters (throttle + debounce) surfaces aurelia/invalid-binding-pattern",
    "markup": "<div textcontent.bind=\"value & throttle & debounce\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "R-D-28 single rate-limiter (debounce only) has no diagnostic",
    "markup": "<div textcontent.bind=\"value & debounce\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-29 single rate-limiter (throttle only) has no diagnostic",
    "markup": "<div textcontent.bind=\"value & throttle\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-30 assignment to $host surfaces aurelia/invalid-binding-pattern",
    "markup": "<div au-slot textcontent.bind=\"$host = newValue\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "R-D-31 assignment to $host.prop surfaces aurelia/invalid-binding-pattern",
    "markup": "<div au-slot textcontent.bind=\"$host.value = newValue\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/invalid-binding-pattern" }
      ]
    }
  },
  {
    "name": "R-D-32 reading $host has no diagnostic",
    "markup": "<div au-slot textcontent.bind=\"$host.value\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-40 unknown custom element surfaces aurelia/unknown-element",
    "markup": "<my-widget></my-widget>",
    "expect": {
      "items": [],
      "diags": [
        { "code": "aurelia/unknown-element" }
      ]
    }
  },
  {
    "name": "R-D-41 unknown custom element with multiple props -> aurelia/unknown-element only (aurelia/unknown-bindable suppressed)",
    "comment": "Root cause is unknown element; property errors are cascading and suppressed",
    "markup": "<my-widget foo.bind=\"a\" bar.bind=\"b\" baz.bind=\"c\"></my-widget>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "foo", "target": "unknown", "effectiveMode": "toView" },
        { "kind": "prop", "to": "bar", "target": "unknown", "effectiveMode": "toView" },
        { "kind": "prop", "to": "baz", "target": "unknown", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-element" }
      ]
    }
  },
  {
    "name": "R-D-42 native element (no dash) with unknown prop still surfaces aurelia/unknown-bindable",
    "comment": "Native elements don't trigger aurelia/unknown-element since they're not custom elements",
    "markup": "<div unknownprop.bind=\"x\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "unknownprop", "target": "unknown", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-bindable" }
      ]
    }
  },
  {
    "name": "R-D-43 registered custom element has no aurelia/unknown-element",
    "semOverrides": {
      "resources": {
        "elements": {
          "my-component": {
            "kind": "element",
            "name": "my-component",
            "bindables": {
              "value": { "name": "value" }
            }
          }
        }
      }
    },
    "markup": "<my-component value.bind=\"x\"></my-component>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "value", "target": "bindable", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-44 registered custom element with unknown prop surfaces aurelia/unknown-bindable",
    "comment": "Known element but unknown bindable property (HTML lowercases attr names)",
    "semOverrides": {
      "resources": {
        "elements": {
          "my-component": {
            "kind": "element",
            "name": "my-component",
            "bindables": {
              "value": { "name": "value" }
            }
          }
        }
      }
    },
    "markup": "<my-component unknownprop.bind=\"x\"></my-component>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "unknownprop", "target": "unknown", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-bindable" }
      ]
    }
  },
  {
    "name": "R-D-45 multiple unknown behaviors accumulate diagnostics",
    "markup": "<div textcontent.bind=\"value & unknown1 & unknown2\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-behavior" },
        { "code": "aurelia/unknown-behavior" }
      ]
    }
  },
  {
    "name": "R-D-46 multiple unknown converters accumulate diagnostics",
    "markup": "<div textcontent.bind=\"value | unknown1 | unknown2\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-converter" },
        { "code": "aurelia/unknown-converter" }
      ]
    }
  },
  {
    "name": "R-D-47 unknown behavior AND unknown converter combined",
    "markup": "<div textcontent.bind=\"value | unknownConv & unknownBeh\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "textContent", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-converter" },
        { "code": "aurelia/unknown-behavior" }
      ]
    }
  },
  {
    "name": "R-D-48 multiple [case] values in same switch are allowed",
    "markup": "<div switch.bind=\"x\"><template case.bind=\"1\">one</template><template case.bind=\"2\">two</template><template case.bind=\"3\">three</template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-D-49 custom attribute with unknown prop surfaces aurelia/unknown-bindable",
    "comment": "HTML lowercases attribute names",
    "semOverrides": {
      "resources": {
        "attributes": {
          "tooltip": {
            "kind": "attribute",
            "name": "tooltip",
            "isTemplateController": false,
            "bindables": {
              "message": { "name": "message" }
            },
            "primary": "message"
          }
        }
      }
    },
    "markup": "<div tooltip.bind=\"msg\" unknownattr.bind=\"x\"></div>",
    "expect": {
      "items": [
        { "kind": "prop", "to": "message", "target": "bindable", "effectiveMode": "toView" },
        { "kind": "prop", "to": "unknownattr", "target": "unknown", "effectiveMode": "toView" }
      ],
      "diags": [
        { "code": "aurelia/unknown-bindable" }
      ]
    }
  },
  {
    "name": "R-D-50 multiple tail options with one unknown surfaces aurelia/invalid-command-usage once",
    "markup": "<ul repeat.for=\"item of items; key.bind: item.id; unknownOpt: foo\"></ul>",
    "expect": {
      "items": [
        { "kind": "iterator", "res": "repeat", "to": "items" }
      ],
      "diags": [
        { "code": "aurelia/invalid-command-usage" }
      ]
    }
  }
]
