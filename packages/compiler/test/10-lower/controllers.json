[
  {
    "name": "LC-01 controller value: if.bind",
    "markup": "<div if.bind=\"p\"></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" }
      ]
    }
  },
  {
    "name": "LC-02 attrs lifted inside controller",
    "markup": "<el name.bind=\"name\" title.bind=\"title\" if.bind=\"p\"></el>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "name" },
        { "kind": "propCommand", "command": "bind", "code": "title" },
        { "kind": "controllerValue", "command": "bind", "code": "p" }
      ]
    }
  },
  {
    "name": "LC-03 nested controllers chain",
    "markup": "<div if><div with><div promise><div portal></div></div></div></div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "with" },
        { "name": "promise" },
        { "name": "portal" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "controllerValue", "command": "bind", "code": "with" },
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "controllerValue", "command": "bind", "code": "portal" }
      ]
    }
  },
  {
    "name": "LC-04 controllers on inner child",
    "markup": "<div><div if id=\"1\" repeat.for=\"i of ii\" with></div></div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "repeat" },
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "iterator", "code": "i of ii" },
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "controllerValue", "command": "bind", "code": "with" }
      ]
    }
  },
  {
    "name": "LC-05 multiple controllers on same element (wrap right-to-left)",
    "markup": "<div if.bind=\"i\" with.bind=\"w\" promise.bind=\"p\"></div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "with" },
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "i" },
        { "kind": "controllerValue", "command": "bind", "code": "w" },
        { "kind": "controllerValue", "command": "bind", "code": "p" }
      ]
    }
  },
  {
    "name": "LC-06 repeat + if + with on same element",
    "markup": "<ul repeat.for=\"i of items\" if.bind=\"cond\" with.bind=\"ctx\"></ul>",
    "expect": {
      "controllers": [
        { "name": "repeat" },
        { "name": "if" },
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "iterator", "code": "i of items" },
        { "kind": "controllerValue", "command": "bind", "code": "cond" },
        { "kind": "controllerValue", "command": "bind", "code": "ctx" }
      ]
    }
  },
  {
    "name": "LC-07 skip local custom element template",
    "markup": "<template as-custom-element=\"user-card\" if.bind=\"c\"></template>",
    "expect": { "controllers": [], "expressions": [] }
  },
  {
    "name": "LC-08 promise branches with then/catch and inner text",
    "markup": "<div promise><template then=\"r\"><span>${a}</span></template><template catch><span>${b}</span></template></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "text", "code": "a" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "LC-09 switch with case/default and inner text",
    "markup": "<div switch.bind=\"x\"><template case=\"1\"><span>${a}</span></template><template default-case><span>${b}</span></template></div>",
    "expect": {
      "controllers": [
        { "name": "switch" },
        { "name": "case" },
        { "name": "default-case" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "x" },
        { "kind": "controllerValue", "command": "bind", "code": "\"1\"" },
        { "kind": "text", "code": "a" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "LC-10 switch default-case only (value-less controller)",
    "markup": "<div switch><template default-case><span>${a}</span></template></div>",
    "expect": {
      "controllers": [
        { "name": "switch" },
        { "name": "default-case" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "switch" },
        { "kind": "text", "code": "a" }
      ]
    }
  },
  {
    "name": "LC-11 promise.bind with then branch only",
    "markup": "<div promise.bind=\"p\"><template then><b>${a}</b></template></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "a" }
      ]
    }
  },
  {
    "name": "LC-12 promise.catch only (value-less)",
    "markup": "<div promise><template catch><i>${e}</i></template></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "text", "code": "e" }
      ]
    }
  },
  {
    "name": "LC-13 ref lifted inside if controller",
    "markup": "<div ref=el if.bind=\"c\"></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "ref", "on": "element", "code": "el" },
        { "kind": "controllerValue", "command": "bind", "code": "c" }
      ]
    }
  },
  {
    "name": "LC-14 style.prop with controller",
    "markup": "<div bg.style=\"a\" if></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "propCommand", "command": "bind", "code": "a" },
        { "kind": "controllerValue", "command": "bind", "code": "if" }
      ]
    }
  },
  {
    "name": "LC-15 attr interpolation with controller",
    "markup": "<div if title=\"a ${b}\"></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "attrInterpolation", "on": "title", "code": "b" }
      ]
    }
  },
  {
    "name": "LC-16 controllers with attribute between",
    "markup": "<div if a.bind=\"b\" with></div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "if" },
        { "kind": "controllerValue", "command": "bind", "code": "with" },
        { "kind": "propCommand", "command": "bind", "code": "b" }
      ]
    }
  },
  {
    "name": "LC-17 colon shorthand inside controller",
    "markup": "<div :title=\"a\" if></div>",
    "expect": {
      "controllers": [
        { "name": "if" }
      ],
      "expressions": [
        { "kind": "propCommand", "command": "to-view", "code": "a" },
        { "kind": "controllerValue", "command": "bind", "code": "if" }
      ]
    }
  },
  {
    "name": "LC-18 @event inside controller",
    "markup": "<div @click=\"go()\" with></div>",
    "expect": {
      "controllers": [
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "event", "on": "click", "command": "trigger", "code": "go()" },
        { "kind": "controllerValue", "command": "bind", "code": "with" }
      ]
    }
  },
  {
    "name": "LC-19 view-model.ref inside controller",
    "markup": "<my-el view-model.ref=\"vm\" with></my-el>",
    "expect": {
      "controllers": [
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "ref", "on": "component", "code": "vm" },
        { "kind": "controllerValue", "command": "bind", "code": "with" }
      ]
    }
  },
  {
    "name": "LC-20 switch with case only",
    "markup": "<div switch.bind=\"x\"><template case=\"y\"><b>${z}</b></template></div>",
    "expect": {
      "controllers": [
        { "name": "switch" },
        { "name": "case" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "x" },
        { "kind": "controllerValue", "command": "bind", "code": "\"y\"" },
        { "kind": "text", "code": "z" }
      ]
    }
  },
  {
    "name": "LC-21 repeat with text inside",
    "markup": "<ul repeat.for=\"i of items\"><li>${i}</li></ul>",
    "expect": {
      "controllers": [
        { "name": "repeat" }
      ],
      "expressions": [
        { "kind": "iterator", "code": "i of items" },
        { "kind": "text", "code": "i" }
      ]
    }
  },
  {
    "name": "LC-22 promise branches on elements (.from-view)",
    "markup": "<div promise.bind=\"p\"><span then.from-view=\"data\">${data.toUpperCase()}</span><i catch.from-view=\"err\">${err}</i><span pending>loading</span></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "data.toUpperCase()" },
        { "kind": "text", "code": "err" }
      ]
    }
  },
  {
    "name": "LC-23 promise branches on elements (plain attr)",
    "markup": "<div promise.bind=\"p\"><span then=\"d\">${d}</span><b catch=\"e\">${e}</b></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "d" },
        { "kind": "text", "code": "e" }
      ]
    }
  },
  {
    "name": "LC-24 promise (value-less) with element branches (value-less)",
    "markup": "<div promise><span then>${a}</span><span catch>${b}</span></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "text", "code": "a" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "LC-25 promise with mixed branch authoring (template + element)",
    "markup": "<div promise.bind=\"p\"><template then=\"x\"><em>${x}</em></template><span catch.from-view=\"y\">${y}</span></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "x" },
        { "kind": "text", "code": "y" }
      ]
    }
  },
  {
    "name": "LC-26 switch with template case+default",
    "markup": "<div switch.bind=\"val\">\n  <template case=\"1\">One</template>\n  <template default-case>Default</template>\n</div>",
    "expect": {
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "val" },
        { "kind": "controllerValue", "command": "bind", "code": "\"1\"" }
      ],
      "controllers": [
        { "name": "switch" },
        { "name": "case" },
        { "name": "default-case" }
      ]
    }
  },
  {
    "name": "LC-27 template repeat as root",
    "markup": "<template repeat.for=\"item of items\">${item}</template>",
    "expect": {
      "expressions": [
        { "kind": "iterator", "code": "item of items" },
        { "kind": "text", "code": "item" }
      ],
      "controllers": [
        { "name": "repeat" }
      ]
    }
  },
  {
    "name": "LC-28 promise before with (prototype path)",
    "markup": "<div promise.bind=\"p\" with.bind=\"ctx\"></div>",
    "expect": {
      "controllers": [
        { "name": "promise" },
        { "name": "with" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "controllerValue", "command": "bind", "code": "ctx" }
      ]
    }
  },
  {
    "name": "LC-29 promise branch attr interpolation (attributeBinding marker)",
    "markup": "<div promise><span then=\"a ${b}\">${b}</span></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "promise" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "LC-30 switch case.bind branch",
    "markup": "<div switch.bind=\"x\"><template case.bind=\"y\" title=\"t ${y}\"><b>${y}</b></template></div>",
    "expect": {
      "controllers": [
        { "name": "switch" },
        { "name": "case" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "x" },
        { "kind": "controllerValue", "command": "bind", "code": "y" },
        { "kind": "attrInterpolation", "on": "title", "code": "y" },
        { "kind": "text", "code": "y" }
      ]
    }
  },
  {
    "name": "LC-31 if/else sibling basic",
    "markup": "<div if.bind=\"x\">true</div><div else>false</div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "else" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "x" }
      ]
    }
  },
  {
    "name": "LC-32 if/else on template elements",
    "markup": "<template if.bind=\"x\">true</template><template else>false</template>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "else" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "x" }
      ]
    }
  },
  {
    "name": "LC-33 if/else with bindings in both branches",
    "markup": "<div if.bind=\"x\">${a}</div><div else>${b}</div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "else" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "x" },
        { "kind": "text", "code": "a" },
        { "kind": "text", "code": "b" }
      ]
    }
  },
  {
    "name": "LC-34 if/else with static content",
    "markup": "<span if.bind=\"show\">visible</span><span else>hidden</span>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "else" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "show" }
      ]
    }
  },
  {
    "name": "LC-35 if/else with attributes on else",
    "markup": "<div if.bind=\"c\" class=\"a\">yes</div><div else class=\"b\">no</div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "else" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "c" }
      ]
    }
  },
  {
    "name": "LC-36 if/else nested - outer else inner if/else",
    "markup": "<div if.bind=\"a\"><span if.bind=\"b\">ab</span><span else>a!b</span></div><div else>!a</div>",
    "expect": {
      "controllers": [
        { "name": "if" },
        { "name": "else" },
        { "name": "if" },
        { "name": "else" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "a" },
        { "kind": "controllerValue", "command": "bind", "code": "b" }
      ]
    }
  },
  {
    "name": "LC-37 promise with template pending branch",
    "markup": "<div promise.bind=\"p\"><template pending>Loading...</template><template then=\"r\">${r}</template></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "r" }
      ]
    }
  },
  {
    "name": "LC-38 promise with all three template branches",
    "markup": "<div promise.bind=\"p\"><template pending>Wait...</template><template then=\"v\">${v}</template><template catch=\"e\">${e}</template></div>",
    "expect": {
      "controllers": [
        { "name": "promise" }
      ],
      "expressions": [
        { "kind": "controllerValue", "command": "bind", "code": "p" },
        { "kind": "text", "code": "v" },
        { "kind": "text", "code": "e" }
      ]
    }
  }
]
