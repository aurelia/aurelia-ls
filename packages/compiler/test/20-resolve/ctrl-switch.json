[
  {
    "name": "R-SW-01 switch with multiple static case values",
    "markup": "<div switch.bind=\"status\"><template case=\"active\">Active</template><template case=\"inactive\">Inactive</template><template case=\"pending\">Pending</template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-SW-02 switch with case.bind dynamic expression",
    "markup": "<div switch.bind=\"code\"><template case.bind=\"errorCode\">Error</template><template case.bind=\"warningCode\">Warning</template><template default-case>OK</template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "branch", "res": "default-case", "branch": "default" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-SW-03 switch with nested elements between switch and case (wrapper allowed)",
    "comment": "Native elements between switch and case are allowed per runtime behavior",
    "markup": "<div switch.bind=\"status\"><div class=\"wrapper\"><template case=\"a\">A</template></div></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-SW-04 switch > if > case surfaces AU0815 (case blocked by if)",
    "comment": "Template controllers create scope boundaries that block case visibility to switch",
    "markup": "<div switch.bind=\"status\"><template if.bind=\"show\"><template case=\"a\">A</template></template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "if", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": [
        { "code": "AU0815" }
      ]
    }
  },
  {
    "name": "R-SW-05 switch > repeat > case surfaces AU0815 (case blocked by repeat)",
    "comment": "Template controllers create scope boundaries that block case visibility to switch",
    "markup": "<div switch.bind=\"status\"><template repeat.for=\"s of statuses\"><template case.bind=\"s\">Match</template></template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "iterator", "res": "repeat", "to": "items" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": [
        { "code": "AU0815" }
      ]
    }
  },
  {
    "name": "R-SW-06 switch on element with repeat (valid pattern)",
    "comment": "Multiple TCs on same element - switch and repeat can coexist",
    "markup": "<div repeat.for=\"s of statuses\" switch.bind=\"s\"><template case=\"active\">Active</template><template case=\"inactive\">Inactive</template></div>",
    "expect": {
      "items": [
        { "kind": "iterator", "res": "repeat", "to": "items" },
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-SW-07 switch on element with if (valid pattern)",
    "comment": "Multiple TCs on same element - switch and if can coexist",
    "markup": "<div if.bind=\"show\" switch.bind=\"status\"><template case=\"a\">A</template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "if", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-SW-08 case with bindings inside",
    "markup": "<div switch.bind=\"mode\"><template case=\"edit\"><span class.bind=\"cls\">${itemName}</span></template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "prop", "to": "class", "target": "native", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-SW-09 switch with case on custom element",
    "semOverrides": {
      "resources": {
        "elements": {
          "my-echo": {
            "kind": "element",
            "name": "my-echo",
            "boundary": true,
            "bindables": {
              "message": { "name": "message", "mode": "toView" }
            }
          }
        }
      }
    },
    "markup": "<div switch.bind=\"status\"><my-echo case=\"delivered\" message.bind=\"msg\"></my-echo></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "prop", "to": "message", "target": "bindable", "effectiveMode": "toView" }
      ],
      "diags": []
    }
  },
  {
    "name": "R-SW-10 nested switch (switch inside case)",
    "markup": "<div switch.bind=\"outer\"><template case=\"a\"><div switch.bind=\"inner\"><template case=\"x\">X</template><template case=\"y\">Y</template></div></template></div>",
    "expect": {
      "items": [
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "ctrlProp", "res": "switch", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" },
        { "kind": "ctrlProp", "res": "case", "to": "value", "target": "controller", "effectiveMode": "toView" },
        { "kind": "branch", "res": "case", "branch": "case" }
      ],
      "diags": []
    }
  }
]
